---
import PostInfo from "@atoms/PostInfo.astro";
import Base from "@layouts/Base.astro";
import { sortByDescending } from "@util/Util";

export async function getStaticPaths({ paginate }) {
	const allPosts = await Astro.glob("./*.md");
	sortByDescending(allPosts, post => new Date(post.frontmatter.date));

	return paginate(allPosts, { pageSize: 5 })
}

const { page } = Astro.props;
const previousPage = page.currentPage - 1;
const nextPage = page.currentPage + 1;
const onFirstPage = previousPage <= 0;
const onLastPage = nextPage > page.lastPage;
---

<Base>
<div class="columns is-centered">
	<div class="column is-10">
		<section class="section">
			<main class="content container">
				{page.data.map(post => (
				<PostInfo {post} />
				))}
			</main>

			<nav class="pagination is-centered" role="navigation" aria-label="pagination">
				<a class="pagination-previous" disabled={onFirstPage} href={onFirstPage ? false : "/en/blog/1" }>
					<span class="icon"><i class="fas fa-angles-left"></i></span>
					<span class="is-hidden-mobile">First</span>
				</a>

				<a class="pagination-previous" disabled={onFirstPage} href={onFirstPage ? false : `/en/blog/${previousPage}`}>
					<span class="icon"><i class="fas fa-angle-left"></i></span>
					<span class="is-hidden-mobile">Previous</span>
				</a>

				<ul class="pagination-list">
					{!onFirstPage && (
					<li>
						<a class="pagination-link" href={`/en/blog/${previousPage}`} aria-label={`Goto page
							${previousPage}`}>{previousPage}</a>
					</li>
					)}

					<li>
						<a class="pagination-link is-current" aria-label={`Page ${page.currentPage}`}>{page.currentPage}</a>
					</li>

					{!onLastPage && (
					<li>
						<a class="pagination-link" href={`/en/blog/${nextPage}`} aria-label={`Goto page ${nextPage}`}>{nextPage}</a>
					</li>
					)}
				</ul>

				<a class="pagination-next" disabled={onLastPage} href={onLastPage ? false : `/en/blog/${page.lastPage}`}>
					<span class="icon"><i class="fas fa-angle-right"></i></span>
					<span class="is-hidden-mobile">Next</span>
				</a>

				<a class="pagination-next" disabled={onLastPage} href={onLastPage ? false : `/en/blog/${nextPage}`}>
					<span class="icon"><i class="fas fa-angles-right"></i></span>
					<span class="is-hidden-mobile">Last</span>
				</a>
			</nav>
		</section>
	</div>
</div>
</Base>